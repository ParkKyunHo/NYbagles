# NEXT_TASKS.md - 다음 작업 목록

최종 업데이트: 2025년 7월 31일

## 🚨 긴급 작업 (Critical)

### 1. 시스템 중복 문제 해결
- [ ] products/v2 페이지의 자동 마이그레이션 로직 제거
- [ ] 기존 데이터를 products_v2로 안전하게 마이그레이션
- [ ] 대시보드를 새 시스템 데이터로 업데이트
- [ ] 모든 페이지가 일관된 시스템 사용하도록 통일

### 2. 미해결 이슈
- [ ] 시스템 관리자 매장 선택 제한 문제 해결
- [ ] 회원가입 비밀번호 입력란 추가

## 📅 단기 작업 (1-2주)

### 1. 데이터 정리
- [ ] 기존 시스템 데이터 백업
- [ ] products_v2로 완전 마이그레이션
- [ ] 기존 테이블 비활성화

### 2. UI/UX 개선
- [ ] 대시보드 새 시스템 연동
- [ ] 매출 분석 대시보드 강화
- [ ] 모바일 반응형 최적화

## 🎯 중기 작업 (1개월)

### 1. 기능 완성
- [ ] 알림 시스템 구현
- [ ] 백업/복구 기능
- [ ] 문서 관리 UI 완성

### 2. 성능 최적화
- [ ] 쿼리 최적화
- [ ] 캐싱 전략 수립
- [ ] 로딩 속도 개선

## 📝 작업 우선순위 가이드

### 즉시 해결 필요
1. **duplicate key constraint 오류**
   - products/v2 페이지 수정
   - 마이그레이션 로직 분리

2. **대시보드 업데이트**
   - 새 시스템 데이터 연동
   - 실시간 반영 확인

### 순차적 진행
1. 시스템 관리자 권한 문제
2. 회원가입 프로세스 개선
3. 데이터 마이그레이션 완료
4. 기존 시스템 제거

## 🔧 기술적 고려사항

### 마이그레이션 전략
```sql
-- 1. 기존 데이터 백업
-- 2. products_v2로 데이터 복사
-- 3. 충돌 방지를 위한 constraint 확인
-- 4. 점진적 전환
```

### 시스템 통합 체크리스트
- [ ] 모든 페이지가 products_v2 사용
- [ ] sales 테이블로 판매 기록 통일
- [ ] daily_closing으로 마감 처리
- [ ] 기존 테이블 참조 제거

## 📊 진행 상황 추적

### 완료된 작업
- ✅ 새 시스템 설계 및 구현
- ✅ 간편 판매/상품관리/일일마감 페이지
- ✅ 마이그레이션 SQL 작성

### 진행중
- 🔄 시스템 중복 문제 해결
- 🔄 문서 업데이트

### 대기중
- ⏳ 전체 데이터 마이그레이션
- ⏳ 기존 시스템 제거
- ⏳ 성능 최적화

---

## ✅ 완료된 작업 (2025년 7월 30일 8차 업데이트)

### Phase 1: 시스템 안정화 ✅ 완료

1. **데이터베이스 정리**
   - store_id NOT NULL 제약 조건 추가 완료
   - 데이터 무결성 보장

2. **문서 스토리지 지원**
   - documents 테이블에 storage_path, file_size, mime_type 컬럼 추가
   - 문서 만료 알림 뷰 생성
   - 문서 업로드 로그 시스템 구현
   - Storage bucket은 Supabase Dashboard에서 수동 생성 필요

3. **급여 계산 시스템 (간소화 버전)**
   - 시급 × 근무시간 계산 기능 구현
   - 관리자가 직원별 시급 설정 가능
   - 월별 급여 계산 및 조회
   - 출퇴근 시간 자동 계산 트리거 추가

4. **프로덕션 배포**
   - GitHub 리포지토리 생성 및 코드 푸시
   - Vercel 프로덕션 배포 완료
   - 자동 CI/CD 파이프라인 구성
   - 배포 가이드 문서 작성 (UPDATE_GUIDE.md, VERCEL_DEPLOYMENT_GUIDE.md)

5. **UI/UX 개선 (7/30 완료)**
   - QR 출퇴근 대시보드 404 에러 수정
   - 상품 관리 카테고리 모달 추가
   - WCAG 접근성 개선 (폰트 대비)
   - 매장 관리 UI 개선 (시/도, 구/군 레이블)

6. **전국 지역 데이터 추가 (7/30 완료)**
   - 17개 시/도 데이터 추가
   - 229개 구/군/시 데이터 추가
   - 데이터 추가 스크립트 작성

7. **직원 회원가입 개선 (7/30 완료)**
   - 매장 선택 UI 개선 (지역별 그룹화)
   - 매장 위치 정보 표시 (시/도 - 구/군)
   - 로딩 상태 및 에러 처리 추가

8. **상품 관리 시스템 개선 (7/30 8차 업데이트 완료)**
   - RLS 정책 중복 제거 및 정리
   - NULL category_id 문제 해결 (기본 카테고리 할당)
   - 카테고리 관리 모달 UI 개선 (폰트 색상)
   - ESLint 및 TypeScript 빌드 오류 수정

## 📋 다음 개발 우선순위

### 긴급 수정 사항

1. **직원 회원가입 요청 실패 문제 해결** (우선순위: 높음)
   - 현상: 회원가입 요청 시 "회원가입 요청에 실패했습니다" 에러 발생
   - 원인 분석:
     - RLS 정책 문제 가능성
     - 데이터베이스 제약 조건 충돌
     - 클라이언트 연결 문제
     - 에러 로깅 부족으로 정확한 원인 파악 어려움
   
   - 해결 방안:
     a) 디버깅 개선
        - EmployeeSignupForm에 상세 에러 로깅 추가
        - Supabase 에러 코드와 메시지 표시
     
     b) RLS 정책 검증 및 수정
        - employee_signup_requests 테이블 정책 재검토
        - anon 역할 INSERT 권한 명시적 추가
     
     c) 폼 데이터 검증 강화
        - 이메일 형식 검증
        - 필수 필드 검증
     
     d) 대체 접근 방식
        - 서버 사이드 API 엔드포인트 생성 고려
        - Next.js API 라우트 활용

   - 예상 변경 파일:
     - /components/auth/EmployeeSignupForm.tsx
     - /supabase/migrations/[timestamp]_fix_employee_signup_policies.sql
     - /app/api/auth/signup/route.ts (필요시)

### Phase 2: 필수 기능 추가 (진행중, 2-3주)
1. **알림 시스템**
   - Supabase Edge Functions로 이메일 알림
   - 실시간 알림 (Supabase Realtime)
   - 알림 설정 페이지 기능 구현

2. **백업 및 복구**
   - 자동 백업 스케줄
   - 데이터 내보내기 기능
   - 복구 프로세스 문서화

3. **문서 관리 UI**
   - /dashboard/documents 페이지 구현
   - 문서 업로드 인터페이스
   - 문서 조회 및 다운로드
   - 만료 알림 대시보드

### Phase 3: 고급 기능 (4-6주)
1. **경영진 대시보드**
   - 실시간 매출 현황
   - 직원 근무 현황
   - KPI 모니터링
   - 매장별 비교 분석

2. **모바일 앱**
   - PWA 최적화
   - 오프라인 지원
   - 푸시 알림
   - 또는 React Native 앱 개발

3. **인공지능 기능**
   - 매출 예측
   - 스케줄 최적화
   - 이상 패턴 감지

## 🧪 테스트 계획

### 1. 단위 테스트
- 핵심 비즈니스 로직
- 유틸리티 함수
- API 엔드포인트

### 2. 통합 테스트
- 사용자 시나리오
- 권한 시스템
- 데이터 흐름

### 3. 성능 테스트
- 로딩 시간
- 동시 사용자
- 데이터베이스 쿼리

## 📚 문서화 필요

1. **사용자 매뉴얼**
   - 직원용 가이드
   - 매니저용 가이드
   - 관리자용 가이드

2. **API 문서**
   - 엔드포인트 명세
   - 인증 방식
   - 에러 코드

3. **배포 가이드**
   - 환경 설정
   - 배포 프로세스
   - 모니터링 설정

## 🔒 보안 강화

1. **보안 감사**
   - SQL Injection 방지
   - XSS 방지
   - CSRF 방지

2. **접근 제어**
   - IP 화이트리스트
   - 2FA 구현
   - 세션 관리

3. **데이터 암호화**
   - 민감 정보 암호화
   - 통신 암호화
   - 백업 암호화

## 💡 사용자 피드백 기반 개선

1. **UI/UX 개선**
   - 사용성 테스트
   - 접근성 개선
   - 반응형 최적화

2. **기능 요청**
   - 사용자 피드백 수집
   - 우선순위 평가
   - 로드맵 업데이트

3. **성능 최적화**
   - 쿼리 최적화
   - 캐싱 전략
   - 번들 크기 최적화