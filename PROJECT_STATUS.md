# 베이글샵 통합 관리 시스템 - 프로젝트 현황

## 📅 최종 업데이트: 2025년 7월 29일 (5차) - 프로덕션 배포 완료

## 🎯 프로젝트 개요
뉴욕러브베이글 매장의 통합 관리를 위한 웹 기반 시스템입니다. QR 코드 기반 출퇴근 관리, 매출 관리, 직원 관리 등의 기능을 제공합니다.

## 🚀 배포 현황
- **프로덕션 사이트**: Vercel에 배포 완료
- **GitHub 리포지토리**: https://github.com/ParkKyunHo/NYbagles.git
- **자동 배포**: main 브랜치 푸시 시 자동 배포

## ✅ 구현 완료된 기능

### 1. 인증 시스템
- **Supabase Auth 기반 로그인/로그아웃**
  - 이메일/비밀번호 인증
  - 세션 관리
  - 자동 로그아웃
- **역할 기반 접근 제어 (RBAC)**
  - super_admin: 전체 시스템 관리
  - admin: 지역 매장 관리
  - manager: 단일 매장 관리
  - employee/part_time: 일반 직원

### 2. QR 코드 시스템
- **매장별 고유 QR 코드**
  - 30초마다 자동 갱신 (TOTP 기반)
  - AES-256 암호화
  - HMAC-SHA256 서명 검증
- **QR 스캐너 페이지** (`/dashboard/attendance/scan`)
  - 카메라 권한 요청
  - 실시간 QR 코드 스캔
  - 스캔 결과 검증
  - **GPS 위치 트래킹 통합** ✅
- **출퇴근 기록 자동화** ✅
  - QR 스캔 → 출퇴근 기록 생성
  - 근무 시간 자동 계산
  - 주간/월간 통계 표시

### 3. 데이터베이스 구조
- **계층적 조직 구조**
  - regions (지역)
  - store_categories (매장 카테고리)
  - stores (매장)
  - employees (직원)
- **QR 토큰 관리**
  - qr_tokens 테이블
  - 토큰 생성 및 검증 함수
- **출퇴근 기록**
  - attendance_records 테이블
  - QR 검증 필드

### 4. 구현된 페이지
- **인증 관련**
  - `/login` - 로그인 페이지 ✅
  - `/signup` - 회원가입 선택 페이지 ✅
  - `/signup/employee` - 직원 회원가입 페이지 ✅
- **대시보드**
  - `/dashboard` - 메인 대시보드 ✅ (7/27 출퇴근 통계 개선)
  - `/dashboard/attendance` - 출퇴근 메인 페이지 ✅
  - `/dashboard/attendance/scan` - QR 스캔 페이지 ✅ (7/27 GPS 통합)
  - `/dashboard/work-hours` - 근무 시간 조회 ✅ (7/27 구현)
- **스케줄 관리** (7/27 구현)
  - `/schedule` - 스케줄 메인 페이지 ✅
  - `/schedule/create` - 스케줄 등록 페이지 ✅
- **상품 관리** (7/27 구현)
  - `/products` - 상품 카탈로그 관리 ✅
  - `/products/create` - 상품 등록 페이지 ✅
  - `/products/store` - 매장별 상품 관리 ✅
- **관리자**
  - `/admin` - 관리자 대시보드 ✅ (7/27 전면 개편)
  - `/admin/signup-requests` - 직원 가입 승인 페이지 ✅ (7/27 구현)

### 5. 인프라 및 보안
- **보안 미들웨어**
  - Rate Limiting (IP당 요청 제한)
  - CORS 설정
  - 보안 헤더 (XSS, CSRF 방지)
- **에러 처리**
  - 중앙집중식 에러 핸들링
  - 도메인별 에러 클래스
  - 사용자 친화적 에러 메시지
- **로깅 시스템**
  - 구조화된 로그
  - 개발/프로덕션 환경별 설정

### 6. 초기 데이터
- **지역**: 서울, 경기, 부산
- **매장 카테고리**: 강남구, 종로구, 마포구
- **샘플 매장**:
  - NY베이글 강남역점
  - NY베이글 삼성점
- **관리자 계정**: admin@nylovebagel.com

### 6. 판매 관리 시스템 ✅ (7/27 구현)
- **백엔드 구현**
  - sales_records 테이블 확장 (결제 방법, 취소 기능)
  - sales_items 테이블 (다중 상품 판매 지원)
  - daily_sales_summary 테이블 (일일 매출 자동 집계)
  - API 엔드포인트 (생성, 조회, 취소, 통계)
- **프론트엔드 구현**
  - `/dashboard/sales` - 판매 입력 페이지 ✅
  - `/dashboard/sales/history` - 판매 내역 조회 ✅
  - `/dashboard/sales/summary` - 매출 요약 대시보드 ✅
  - 실시간 재고 확인 및 장바구니 기능
  - 역할별 권한 관리 (취소는 매니저 이상)

### 7. 직원 관리 시스템 ✅ (7/27 구현)
- **직원 목록 페이지**
  - `/dashboard/employees` - 전체 직원 목록 ✅
  - 검색 및 필터링 (이름, 매장, 직급)
  - 직원 상태 관리 (활성/비활성)
  - 통계 표시 (전체, 활성, 매니저, 파트타임)
- **직원 상세 페이지**
  - `/dashboard/employees/[id]` - 개별 직원 정보 ✅
  - 정보 수정 기능 (관리자만)
  - 최근 30일 근무 기록
  - 향후 14일 스케줄 표시
- **권한 관리**
  - 매니저는 자기 매장 직원만 조회
  - 관리자는 전체 직원 관리 가능

## ❌ 미구현 기능

### 아직 구현되지 않은 주요 기능들

1. **고급 스케줄 기능**
   - 스케줄 변경 요청 시스템
   - 스케줄 템플릿 관리
   - 스케줄 충돌 감지

2. **알림 시스템**
   - 실시간 알림 (Supabase Realtime)
   - 이메일 알림 (Edge Functions)
   - 푸시 알림 (PWA)

3. **리포트 생성**
   - PDF 리포트 생성
   - 정기 리포트 스케줄링
   - 커스텀 리포트 빌더

4. **백업 및 복구**
   - 자동 백업 시스템
   - 데이터 내보내기/가져오기
   - 복구 프로세스

5. **모바일 앱**
   - PWA 최적화
   - 오프라인 모드
   - 네이티브 앱 개발

### 11. 직원 회원가입 개선 ✅ (7/28 구현)
- **매장 선택 기능**
  - 매장 코드 입력 대신 드롭다운 선택
  - 활성 매장만 표시
  - 가입 요청 시 매장 정보 포함

### 12. 관리자 기능 개선 ✅ (7/28 구현)
- **가입 승인 페이지**
  - 직원 소속 매장 변경 기능
  - 매장 변경 모달 UI
  - 실시간 매장 정보 업데이트

### 13. 급여 관리 시스템 ✅ (7/29 구현)
- **간소화된 급여 계산**
  - `/dashboard/salary` - 급여 관리 페이지 ✅
  - 직원별 시급 설정 기능
  - 출퇴근 기록 기반 자동 시간 계산
  - 시급 × 근무시간 계산
  - 월별 급여 조회 및 관리
  - 출퇴근 시간 자동 계산 트리거

### 14. 데이터베이스 개선 ✅ (7/29 구현)
- **데이터 무결성**
  - employees.store_id NOT NULL 제약 조건 추가
  - 문서 스토리지 지원 테이블 및 함수 추가
  - 문서 만료 알림 시스템
  - 문서 업로드 로그 추적

### 15. 문서 관리 시스템 ✅ (7/29 구현)
- **문서 스토리지 인프라**
  - Supabase Storage 통합
  - 문서 카테고리 관리 (신분증, 계약서, 건강진단서 등)
  - 문서 만료일 추적 및 알림
  - 업로드 이력 관리
  - `/dashboard/documents` - 문서 관리 페이지 (구현 예정)

## 🚀 다음 개발 우선순위

### Phase 1: 시스템 안정화 ✅ (완료)
- ~~데이터베이스 정리 (store_id NULL 값 처리)~~
- ~~문서 스토리지 지원 추가~~
- ~~급여 계산 시스템 구현 (시급 × 시간)~~
- ~~프로덕션 배포~~

### Phase 2: 고급 기능 (진행중)
1. **알림 시스템**
   - 실시간 알림 (Supabase Realtime)
   - 이메일 알림 (Edge Functions)
   - 푸시 알림 (PWA)

2. **백업 및 복구**
   - 자동 백업 시스템
   - 데이터 내보내기/가져오기
   - 복구 프로세스

3. **문서 관리 UI**
   - 문서 업로드 페이지
   - 문서 조회 및 다운로드
   - 만료 알림 대시보드

### Phase 3: 확장 기능
1. **리포트 및 대시보드**
   - 경영진 대시보드
   - 매출 리포트 자동 생성
   - KPI 모니터링

2. **모바일 최적화**
   - PWA 기능 강화
   - 오프라인 모드 개선
   - 푸시 알림 통합

## 📁 프로젝트 문서
- **README.md** - 프로젝트 소개 및 시작 가이드
- **CLAUDE.md** - Claude AI 작업 가이드
- **UPDATE_GUIDE.md** - 코드 수정 및 업데이트 가이드 ✨
- **VERCEL_DEPLOYMENT_GUIDE.md** - Vercel 배포 가이드 ✨
- **PROJECT_STATUS.md** - 프로젝트 현황 (이 문서)
- **NEXT_TASKS.md** - 다음 작업 목록
- **ADMIN_SETUP_GUIDE.md** - 관리자 계정 설정 방법
- **TEST_RESULTS.md** - 테스트 결과 및 체크리스트

## 🛠 기술 스택
- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Backend**: Supabase (PostgreSQL, Auth, Storage)
- **Security**: TOTP, AES-256, HMAC-SHA256
- **PWA**: Service Worker, 오프라인 지원

## 📝 참고사항
- 모든 404 오류 페이지는 향후 개발 예정
- PWA 기능으로 인해 오프라인 페이지가 표시될 수 있음 (시크릿 모드 사용 권장)
- 관리자 계정은 Supabase Dashboard에서 수동 생성 필요